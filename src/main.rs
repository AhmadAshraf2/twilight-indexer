mod block_types;
mod db;
mod pubsub_chain;
mod transaction_types;
mod schema;
mod quis_quis_tx;

use crate::quis_quis_tx::decode_qq_transaction;
use crate::quis_quis_tx::DecodedQQTx;

fn main() {
    dotenv::dotenv().expect("Failed loading dotenv");
    let blob = "0000000000000000010000000000000000000000000000000100000000000000020201020000000000000000000000000000000768a6b7b95294a949e1927fa8aa8848a87511cfd7cbd6e13ac6e33840d75c60007a41d7ab9891c1ed28d1f56be0b4168547bf7a726105c11799e87173d645fd4e80513c4e784f16eaffdf4c217942ec2e3d60714b6552b61958e2359197307d2f8a0000000000000030636236633533336363653831626362393566636332336339626637666239393837393135333231346330346263346133653465323333616565393261336236306266303263363336306164356565366539653334363361643833343032623031346234313439666461373230613536396366633237326131333065393263353533323337396138306200000000000000000000000000000000000000000000000000000000000000000000000000000000000044520654c914325fd09fb6d7581e4887c82ce811e11643a8ebc2acbded49b74d26d5f6827c9d50d4b5f3c4dd4a25a6dc83ebd771260e33c5bebd8cd00d0dd0068a000000000000003063636163653837316231646238343932663431646362363465396438623035663764343063323961333137303939303061636335306236643835653263653231633165383130343136613032646131336235636637623934303436306236363539346261646431356137636634316435316630323230326563653263313930376338626462353530320002000000000000000000000000000000dadf931ec6d12bee010b5f35dbb494df336b45b81e99b393803b1b1c66fc2527b2d997d0cdd669a57a46b6e291cfde6066e93796b0317e4bd247fba74f7b746f8a000000000000003063623663353333636365383162636239356663633233633962663766623939383739313533323134633034626334613365346532333361656539326133623630626630326336333630616435656536653965333436336164383334303262303134623431343966646137323061353639636663323732613133306539326335353332333739613830620000000000000000e6b330b65248fc2b4463758f1dfc60e8544c92e95da8ddd7ec8af30d45af0075a63a702e87728d663ad5e79bc40dc5c5fe736494fb3b407c3f85f7e9833387238a000000000000003063636163653837316231646238343932663431646362363465396438623035663764343063323961333137303939303061636335306236643835653263653231633165383130343136613032646131336235636637623934303436306236363539346261646431356137636634316435316630323230326563653263313930376338626462353530320200000000000000b6c533cce81bcb95fcc23c9bf7fb99879153214c04bc4a3e4e233aee92a3b60bf02c6360ad5ee6e9e3463ad83402b014b4149fda720a569cfc272a130e92c5535aee3739136d32837968929acdd622b76604769ed06b34150ecb2246a9b6022aa0b29e1ee695c593ef22a940e0d5bf304016cd64cfd1ee0c4549ed35bf25951acace871b1db8492f41dcb64e9d8b05f7d40c29a31709900acc50b6d85e2ce21c1e810416a02da13b5cf7b940460b66594badd15a7cf41d51f02202ece2c1907ceec5f2e2ce8580a7855d5350ae9f5fa4e733c989ec0d1a8407343222895ac159da4184aaf9727baf0f11fb950a3a5a864988e71eb71341059bbd7185cbf9501e0200000000000000e2f2ae0a6abc4e71a884a961c500515f58e30b6aa582dd8db6a65945e08d2d768c9240b456a9e6dc65c377a1048d745f94a08cdb7f44cbcd7b46f3404887113430d3072ed386d2f927ddaeac3f58d9e8c0e364cb693f317825ae21831cc7f77fbc75d4eca36e043f048f771fca36baca9d72e1b9a14b536dd1edabe85873e82ee2f2ae0a6abc4e71a884a961c500515f58e30b6aa582dd8db6a65945e08d2d768c9240b456a9e6dc65c377a1048d745f94a08cdb7f44cbcd7b46f34048871134e4ad63b29727a015a3c2f8f965a4982bee62f3b7a2f78d66fc5f1b79955f816df48397116cf0255241472e9a762e1e49deccd05013e0c534e3a20096713b2f1f0200000000000000b6c533cce81bcb95fcc23c9bf7fb99879153214c04bc4a3e4e233aee92a3b60bf02c6360ad5ee6e9e3463ad83402b014b4149fda720a569cfc272a130e92c553dadf931ec6d12bee010b5f35dbb494df336b45b81e99b393803b1b1c66fc2527b2d997d0cdd669a57a46b6e291cfde6066e93796b0317e4bd247fba74f7b746fcace871b1db8492f41dcb64e9d8b05f7d40c29a31709900acc50b6d85e2ce21c1e810416a02da13b5cf7b940460b66594badd15a7cf41d51f02202ece2c1907ce6b330b65248fc2b4463758f1dfc60e8544c92e95da8ddd7ec8af30d45af0075a63a702e87728d663ad5e79bc40dc5c5fe736494fb3b407c3f85f7e98333872301000000020000000000000055106b949590d28b410f89cd3d13003e0f783f8bcf055034b7fb3d22a7fc4407a132da41f54e3d083bcadd411ed80beaa9cf8cb064c977e589c26d27016be80002000000000000003e2560b63413263e748d6c111f84905f8170f6bf579c23a10c03533da82d9301fd220a511a67904ad93126e749106964dfe50ffc5e9853008fe18358a2b4290d020000000000000070fb4cd1e9608e9181d3a8fa054cb11c67c8c2217abe10f082267dedfc244d0657ab05126b2033f71e4013fc5bf0744809d09c933607900fb51fc0f58c77230e31e28da87d63379f792fcb219b4490db422355a1faa37074ff188a10866a2d0b0100000000000000e2f2ae0a6abc4e71a884a961c500515f58e30b6aa582dd8db6a65945e08d2d768c9240b456a9e6dc65c377a1048d745f94a08cdb7f44cbcd7b46f34048871134a044367f2fde3f00ecbe0df4019776758c1a3b59fb6127a385b3a2a2f3a3b73840507deeabb0acd23be7d4b917a37e2ec74152ec456083809d407a9e3652a967010000000100000000000000e446b9a93150046db9202aed41ad5c62c575741c2fea82db12ade836a400b8020100000000000000b991e8006c72be4e428a67ecacbad8b6bf6a2af5371e92e6b3072eb585c5db000100000000000000ad32655a6e66dec17bdc1a6773de4bfcf35775bc3a776f5419b551e9fb2b6e08ec0fcae8161f3f03fa6b80bf2b7e7d7eb77202855b4a1b098a7334304659b6040100000000000000e0020000000000009280010e87847472f3b7cbb962d1ced827ef5b3259ce84f5d493f8051bc3252d668483de90a891ba034d8d0fc25cf2f5e0eb48b7a67e83f6eea81643707eee47242c7d88b28787d72d1515395920c3f78bb9d222ccbda1fab0966c636997ef22d450ccc74867db5b1667177530350eaa2cd9782f56d4a18c17779636ac7dcb6d239ee479b2456289be8512bcb1f2d20188a68e2c6c54a86f313e29c58d982d09079cfa9b17853ae26dc5f30973a7e33376db98409dcce87ad6bfb7443b66920ddeb32e9471e9148874fe1af7ebba3da9dab078be593c14a8ef54237bbacb4404c0e5fba516340bd9220a8f4c7c21a62f1ae0bd3679386c0723206b02da55ba36d0768d6b30b99114792436fb34917c3abe66dd781c91b74713604b5ac88220717ce2705b027efc2a86a11c98924caea6fabeeab78fc5a035fccae7d5aae4ed27d2c76fac090fd26fb7dd29d33be2d0781ea111f87e766a605d26ab6422736d3c6cd12af8c930de2180851864642f594f4e337cbe4ed21b5db5e49f3ffba2654ebec0a26f79de7d620f918a34b9f968d710218725b8c6a7b9c04c7030f7815f639c465de3822fd2fa5d2f3e0108d23c5a0ca036fc95079674832a2c504f782712382e4e597b755cdf4c9a7da91868dc5f375b9f12b38d12225afa39e94eaf6e187889340008603f310f93cf079d3e95620dff25966b9478e4096978e2eb6ef16110bbfa59fa0b2e05795a22d30140e6a667b9ca1be594a42377dfcf250bddbb3874793d54d5df9f2a31a46bea1d850ac1bad6b9645402f39daf240cf4c8f7e64fa2c6c88eb4d82366daeb8372239cf54764ee10351e659a683e6d5cedb66fae0afa3a39b49d5705303e81e59cba95015d8f8151fb0e0df77b76529c35fd172e51385047244b0061a737514103693728447695b2e4889f21340f8cf6d50d567319dbf6b5e72d0e779d94721e4a0c713ec4cb2628b654d2cb5c2ab8683a2e5c5007f9ea65964e784aa535ef3e9324f2eef262d539c46e1ea517d37d2de5bb09230e0001000000000000000001010000000000000001000000000000000100000000000000057482cc3e32aeab8aa66c450211e70e2fe25dfc1c4c25a23a15b0215df6810fce58680066cd4be05f79b69b2015a161b8769badef43b1cd09e08f45d20cb005";
        let decoded = decode_qq_transaction(&blob).unwrap();
        match decoded {
                DecodedQQTx::Transfer(tx) => {
                    let inputs = tx.get_input_values();
                    let outputs = tx.get_output_values();
                    if inputs.is_empty() || outputs.is_empty() {
                        eprintln!("⚠️ TransferTransaction has no inputs or outputs");
                    }
                    let owner = inputs[0].as_owner_address();
                    let new_qq_account = outputs[0]
                        .to_quisquis_account()
                        .expect("Failed to convert to quisquis account"
                    );
                    let new_qq_account = hex::encode(
                    bincode::serialize(&new_qq_account)
                        .expect("Failed to serialize account to bytes")
                    );
                    
                }
                DecodedQQTx::Script(script) => {
                    println!("Got script tx: {:?}", script);
                }
                DecodedQQTx::Message(msg) => {
                    println!("Got message tx: {:?}", msg);
                }
        }

    pubsub_chain::subscribe_block();
}